<%- include('common/header.ejs') %>
  <div id="Main_div">
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div id="container">
  <header>
    <a href="#" onclick="history.back()">
      <img class="guide" src="../file/icon/back.png" alt="">
      </a>
      <img src="../file/logo.svg" alt="">
      <img class="guide" id="guide" src="../file/icon/guide.png" alt="">
  </header>
  <!-- ì»¨í…ì¸  --> 
  <div>
    <!-- oooë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ ìƒë‹¨ -->
    <div id="myPage_welcome">
        <div id="myPage_welcome_div">
        <!-- ì™¼ìª½ í™˜ì˜ë° ë¡œê·¸ì•„ì›ƒ -->
        <div id="myPage_welcome_div_left">
          <div id="stamp_hun"></div>
          <div id="stapm_count"></div>
        </div>
        <!-- ì˜¤ë¥¸ìª½ í”„ë¡œí•„ ì´ë¯¸ì§€ -->
        <div class="profile">
          <img class="profile_img" src="../file/icon/profile.png">
        </div>
      </div>
      
    </div>
    <!-- ì§€ì—­ì„ íƒ -->
     <!-- <div id="stampPage_region">
      <div>ì„œìš¸ ê²½ê¸°ë„</div>
      <div>ì¶©ì²­ë„</div>
      <div>ê°•ì›ë„</div>
      <div>ê²½ìƒë„</div>
      <div>ì „ë¼ë„</div>
      <div>ì œì£¼ë„</div>
     </div> -->
  </div>
  <!-- 3x3 ê·¸ë¦¬ë“œ -->
  <div class="grid-container">
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ê³ ë„ë¦¬ ì™€ì´ë„ˆë¦¬">
      <p>ê³ ë„ë¦¬ ì™€ì´ë„ˆë¦¬</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ê¸ˆì •ì‚°ì„± í† ì‚°ì£¼">
      <p>ê¸ˆì •ì‚°ì„± í† ì‚°ì£¼</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ëª…ê°€ì›">
      <p>ëª…ê°€ì›</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ëª…ì¸ì•ˆë™ì†Œì£¼">
      <p>ëª…ì¸ì•ˆë™ì†Œì£¼</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ë¬¸ê²½ì£¼ì¡°">
      <p>ë¬¸ê²½ì£¼ì¡°</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ìˆ˜ë„ì‚°ì™€ì´ë„ˆë¦¬">
      <p>ìˆ˜ë„ì‚°ì™€ì´ë„ˆë¦¬</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ì˜¤ë¯¸ë‚˜ë¼">
      <p>ì˜¤ë¯¸ë‚˜ë¼</p>
    </div>
    <div>
      <img src="../file/icon/stamp.png" class="grid-item " alt="ìš¸ì§„ìˆ ë„ê°€">
      <p>ìš¸ì§„ìˆ ë„ê°€</p>
    </div>
  </div>
  <%- include('common/footer.ejs') %>
  </div>
  </div>
  <script>
        const accessToken = localStorage.getItem("accessToken");
        const info = JSON.parse(localStorage.getItem("userData"));
        const stam = document.getElementById("stamp_hun");
        if(!info.user_name) {
          stam.innerHTML = "ë¡œê·¸ì¸ì´<br /> í•„ìš”í•©ë‹ˆë‹¤."
        } else {
          stam.innerHTML = `${info.user_name}ë‹˜ì˜ <br /> ìŠ¤íƒ¬í”„ í˜„í™©`
        }
        // ìœ ì € ì½”ìŠ¤ ë¶ˆëŸ¬ì˜¤ê¸°
        async function fetchData() {
        const response = await fetch("/api/course", {
          headers: { Authorization: `Bearer ${accessToken}`}
        });
        const result = await response.json();
        const data = result.data;

      
        
        // ì½”ìŠ¤ ë„˜ë²„ê°€ ìˆëŠ” ë°ì´í„°ë§Œ ë½‘ê¸°
        const userCourses = data.filter((item) => {
          return item.user_courses_no !== null;
        });
        // console.log(userCourses);

        // ìƒí’ˆ íšë“ ì¹´ìš´íŠ¸
        const count = document.querySelector("#stapm_count");
        count.textContent = `ìƒí’ˆ íšë“ê¹Œì§€ ${userCourses.length}/5`;

        // ìŠ¤íƒ¬í”„ ë°”ê¾¸ê¸°
        const courseName = document.querySelectorAll(".grid-container > div");
        userCourses.forEach((item) => {
          courseName.forEach((image) => {
            const stampImage = image.querySelector("img");
            if(stampImage.alt === item.course_name) {
              stampImage.src = "";
              stampImage.src = "/file/icon/stampComplete.png";
            };
          });
        });
        // ìŠ¤íƒ¬í”„ê°€ 5ê°œ ì´ìƒì¼ ë•Œ ìƒí’ˆ íšë“ ì•Œë¦¼
        if (userCourses.length >= 5) {
          count.textContent = "";
          count.textContent = "ğŸìƒí’ˆ íšë“ ì™„ë£Œ!";
          // const mission=document.querySelector(".mission")
          const alertShown = localStorage.getItem('alertShown');
          // mission.style.display="block";
          if (!alertShown) {
          Swal.fire({
          title: "ìƒí’ˆ íšë“!",
          imageUrl: "/file/cong.png",
          imageWidth: 100,
          imageHeight: 100,
          imageAlt: "Custom image"
        });
        localStorage.setItem('alertShown', 'true'); // ì•Œë¦¼ì´ í‘œì‹œë˜ì—ˆìŒì„ ì €ì¥
      }
    }
  }
      
      fetchData();
    // í”„ë¡œí•„ì´ ìˆëŠ” ê²½ìš°
    const selectImg=document.querySelector(".profile_img");
    async function fetchProfileImage() {
      const response = await fetch("/api/fileload", {
          headers: {
              Authorization: `Bearer ${accessToken}`
          }
      });
      if (response.ok) {
          const result = await response.json();
          if (result.user_image) {
              selectImg.src = result.user_image;
          }
      } else {
          console.error("ì´ë¯¸ì§€ ì—†ìŒ");
      }
    };
    window.onload = fetchProfileImage;
  </script>
</body>
</html>